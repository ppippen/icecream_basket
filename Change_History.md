# Change History / 变更历史

[English](#english) | [中文](#中文)

---

<a name="english"></a>
## English

### 2025-07-10

#### Feature: Add Sound Effects to UI Buttons

Added sound effects to major button-click events to enhance user interaction and provide auditory feedback.

**Key Changes:**

1.  **Audio Initialization**:
    *   Pre-loaded and decoded `pop.mp3` using the Web Audio API at the start of `script.js` for instant playback.
    *   Created standard `<audio>` elements for the other three sound effects: `undo.mp3`, `checkout.mp3`, and `newOrder.mp3`.
2.  **Encapsulated Playback Functions**:
    *   Created a dedicated function, `playPopSound()`, to play random segments of `pop.mp3`, providing varied sound feedback for adding items. The configuration for the sound clips is:
        ```json
        [
          {"start": 0.11, "duration": 0.02},
          {"start": 0.81, "duration": 0.03},
          {"start": 1.57, "duration": 0.02},
          {"start": 2.08, "duration": 0.03},
          {"start": 2.82, "duration": 0.01}
        ]
        ```
    *   Created three other simple playback functions for `undo.mp3`, `checkout.mp3`, and `newOrder.mp3`.
3.  **Event Binding**:
    *   **Add Item**: Called `playPopSound()` within the `addItemToOrder` function.
    *   **Undo Button**: Invoked the playback function for `undo.mp3` in the undo button's click listener.
    *   **Checkout Button**: Invoked the playback function for `checkout.mp3` in the checkout button's click listener.
    *   **New Order Button**: Invoked the playback function for `newOrder.mp3` in the new order button's click listener.

**Files Modified:**

*   `script.js`: Implemented all logic for loading, playing, and binding sound effects.

### 2025-07-08

#### Feature: Implement scrollable ice cream stack

Implemented a scrollable container for the ice cream and cone, allowing for an unlimited number of scoops to be added without breaking the layout.

**Key Changes:**

-   The ice cream cone is now dynamically generated by JavaScript as the base element of the stack.
-   The ice cream and cone now scroll together as a single unit.
-   The cone correctly appears on top of the ice cream scoops.
-   The view automatically scrolls to the bottom when a new item is added.

**Files Modified:**

-   `index.html`: Removed the static cone element.
-   `styles.css`: Reworked the styles for `.cone-container`, `.ice-cream-stack`, and added a new style for the dynamically created cone (`.cone-style`).
-   `script.js`:
    -   Added logic to initialize the cone on page load.
    -   Modified `updateOrderDisplay` to handle the new stacking logic.
    -   Added auto-scrolling functionality.

### Enhancement: Adjust Checkout Modal Position

Adjusted the vertical position of the checkout modal to ensure the "Start New Order" button is always visible without scrolling.

**Key Changes:**

-   The `margin-top` of the `.modal-content` was reduced.

**Files Modified:**

-   `styles.css`: Modified the `margin` property for `.modal-content`.

### Enhancement: Dynamic Test Port Configuration

Configured Playwright to dynamically select an available port for the local test server, resolving port conflict issues.

**Key Changes:**

-   Playwright's `webServer` now automatically selects a free port.
-   Test navigation uses relative paths.

**Files Modified:**

-   `playwright.config.js`: Removed fixed `port` and adjusted `command` for `webServer`.
-   `tests/icecream.spec.js`: Changed `page.goto` to use a relative path (`/`).

### Refactor: Update Playwright Tests for Dynamic Cone

Rewrote existing Playwright test cases to account for the dynamically added cone element in the ice cream stack, ensuring accurate assertions.

**Key Changes:**

-   Updated assertions for `stack-item` counts to include the cone element.
-   Specifically re-evaluated test cases related to adding items and checking stack contents.

**Files Modified:**

-   `tests/icecream.spec.js`: Modified test cases 2, 3, 5, and 6 to reflect the new DOM structure.

---

<a name="中文"></a>
## 中文

### 2025年7月10日

#### 功能：为界面按钮添加音效

为了增强用户交互的趣味性和反馈感，为应用内的主要按钮点击事件添加了声音效果。

**主要变更：**

1.  **音频初始化**:
    *   在 `script.js` 开头，使用 Web Audio API 预加载并解码 `pop.mp3` 文件，以实现快速、无延迟的播放。
    *   为 `undo.mp3`、`checkout.mp3` 和 `newOrder.mp3` 创建了常规的 `<audio>` 元素用于播放。
2.  **封装播放函数**:
    *   创建了一个专门的函数 `playPopSound()`，用于从一个预设片段列表中随机播放 `pop.mp3` 的一部分，为添加商品的操作提供多样化的音效。音效片段配置如下：
        ```json
        [
          {"start": 0.11, "duration": 0.02},
          {"start": 0.81, "duration": 0.03},
          {"start": 1.57, "duration": 0.02},
          {"start": 2.08, "duration": 0.03},
          {"start": 2.82, "duration": 0.01}
        ]
        ```
    *   为另外三个音效创建了独立的、简单的播放函数。
3.  **事件绑定**:
    *   **添加商品**: 在 `addItemToOrder` 函数中调用 `playPopSound()`。
    *   **撤销按钮**: 在撤销按钮的点击事件监听器中调用 `undo.mp3` 的播放函数。
    *   **结算按钮**: 在结算按钮的点击事件监听器中调用 `checkout.mp3` 的播放函数。
    *   **新订单按钮**: 在新订单按钮的点击事件监听器中调用 `newOrder.mp3` 的播放函数。

**修改的文件**:

*   `script.js`: 实现了所有音效的加载、播放和事件绑定逻辑。

### 2025年7月8日

#### 功能：实现可滚动的冰激凌堆叠

为冰激凌和甜筒实现了一个可滚动的容器，允许无限添加冰激凌球而不会破坏页面布局。

**主要变更：**

-   甜筒现在由 JavaScript 动态生成，作为堆叠的基础元素。
-   冰激凌和甜筒现在作为一个整体一起滚动。
-   甜筒能够正确地显示在冰激凌球的上方。
-   添加新项目时，视图会自动滚动到底部。

**修改的文件：**

-   `index.html`: 移除了静态的甜筒元素。
-   `styles.css`: 重构了 `.cone-container` 和 `.ice-cream-stack` 的样式，并为动态创建的甜筒（`.cone-style`）添加了新样式。
-   `script.js`:
    -   添加了在页面加载时初始化甜筒的逻辑。
    -   修改了 `updateOrderDisplay` 以处理新的堆叠逻辑。
    -   添加了自动滚动功能。

#### 优化：调整结算模态框位置

调整了结算模态框的垂直位置，以确保“开始新订单”按钮始终可见，无需滚动页面。

**主要变更：**

-   `.modal-content` 的 `margin-top` 值被减小。

**修改的文件：**

-   `styles.css`: 修改了 `.modal-content` 的 `margin` 属性。

#### 优化：动态测试端口配置

配置 Playwright 动态选择本地测试服务器的可用端口，解决了端口冲突问题。

**主要变更：**

-   Playwright 的 `webServer` 现在会自动选择一个空闲端口。
-   测试导航使用相对路径。

**修改的文件：**

-   `playwright.config.js`: 移除了固定的 `port`，并调整了 `webServer` 的 `command`。
-   `tests/icecream.spec.js`: 将 `page.goto` 改为使用相对路径 (`/`)。

#### 重构：更新 Playwright 测试以适应动态甜筒

重写了现有的 Playwright 测试用例，以适应冰激凌堆叠中动态添加的甜筒元素，确保断言的准确性。

**主要变更：**

-   更新了 `stack-item` 数量的断言，以包含甜筒元素。
-   特别重新评估了与添加项目和检查堆叠内容相关的测试用例。

**修改的文件：**

-   `tests/icecream.spec.js`: 修改了测试用例 2、3、5 和 6，以反映新的 DOM 结构。
